# Polimoney Hub API 仕様

## 目次

- [認証](#認証)
- [共通仕様](#共通仕様)
- [ヘルスチェック](#ヘルスチェック)
- [政治家 API](#政治家-api)
- [政治団体 API](#政治団体-api)
- [選挙 API](#選挙-api)
- [選挙 ID の形式](#選挙-id-の形式)

---

## 認証

### API Key 認証

すべての `/api/v1/*` エンドポイントは API Key 認証が必要です。

**必須ヘッダー:**

| ヘッダー         | 説明                 |
| ---------------- | -------------------- |
| `X-API-Key`      | API キー             |
| `X-Service-Name` | サービス名（ログ用） |

**例:**

```bash
curl -H "X-API-Key: your-api-key" \
     -H "X-Service-Name: polimoney-ledger" \
     http://localhost:3722/api/v1/politicians
```

**エラーレスポンス:**

```json
// 401 Unauthorized
{ "error": "API Key is required" }

// 401 Unauthorized
{ "error": "Invalid API Key" }
```

---

## 共通仕様

### レスポンス形式

**成功時:**

```json
{
  "data": { ... }
}
```

**エラー時:**

```json
{
  "error": "エラーメッセージ"
}
```

### ステータスコード

| コード | 説明                   |
| ------ | ---------------------- |
| 200    | 成功                   |
| 201    | 作成成功               |
| 400    | リクエストエラー       |
| 401    | 認証エラー             |
| 404    | リソースが見つからない |
| 409    | 競合（重複）           |
| 500    | サーバーエラー         |

---

## ヘルスチェック

### GET /

サービス情報を返します。認証不要。

**レスポンス:**

```json
{
  "name": "Polimoney Hub",
  "version": "0.1.0",
  "status": "ok"
}
```

### GET /health

ヘルスチェック。認証不要。

**レスポンス:**

```json
{ "status": "healthy" }
```

---

## 政治家 API

### GET /api/v1/politicians

政治家一覧を取得します。

**レスポンス:**

```json
{
  "data": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "name": "山田 太郎",
      "name_kana": "ヤマダ タロウ",
      "created_at": "2024-01-01T00:00:00.000Z",
      "updated_at": "2024-01-01T00:00:00.000Z"
    }
  ]
}
```

### GET /api/v1/politicians/:id

政治家詳細を取得します。

**パラメータ:**

| 名前 | 型   | 説明      |
| ---- | ---- | --------- |
| id   | UUID | 政治家 ID |

**レスポンス:**

```json
{
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "山田 太郎",
    "name_kana": "ヤマダ タロウ",
    "created_at": "2024-01-01T00:00:00.000Z",
    "updated_at": "2024-01-01T00:00:00.000Z"
  }
}
```

### POST /api/v1/politicians

新しい政治家 ID を発行します。

**リクエスト:**

```json
{
  "name": "山田 太郎",
  "name_kana": "ヤマダ タロウ" // オプション
}
```

**レスポンス (201):**

```json
{
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "山田 太郎",
    "name_kana": "ヤマダ タロウ",
    "created_at": "2024-01-01T00:00:00.000Z",
    "updated_at": "2024-01-01T00:00:00.000Z"
  }
}
```

### PUT /api/v1/politicians/:id

政治家情報を更新します。

**リクエスト:**

```json
{
  "name": "山田 次郎",
  "name_kana": "ヤマダ ジロウ"
}
```

---

## 政治団体 API

### GET /api/v1/organizations

政治団体一覧を取得します。

**クエリパラメータ:**

| 名前          | 型   | 説明                 |
| ------------- | ---- | -------------------- |
| politician_id | UUID | 政治家 ID でフィルタ |

**レスポンス:**

```json
{
  "data": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440001",
      "name": "山田太郎後援会",
      "type": "support_group",
      "politician_id": "550e8400-e29b-41d4-a716-446655440000",
      "created_at": "2024-01-01T00:00:00.000Z",
      "updated_at": "2024-01-01T00:00:00.000Z"
    }
  ]
}
```

### POST /api/v1/organizations

新しい政治団体 ID を発行します。

**リクエスト:**

```json
{
  "name": "山田太郎後援会",
  "type": "support_group",
  "politician_id": "550e8400-e29b-41d4-a716-446655440000" // オプション
}
```

**type の値:**

| 値                | 説明   |
| ----------------- | ------ |
| `political_party` | 政党   |
| `support_group`   | 後援会 |
| `other`           | その他 |

---

## 選挙 API

### GET /api/v1/elections

選挙一覧を取得します。

**クエリパラメータ:**

| 名前 | 型     | 説明                 |
| ---- | ------ | -------------------- |
| type | string | 選挙タイプでフィルタ |
| year | number | 年でフィルタ         |

**レスポンス:**

```json
{
  "data": [
    {
      "id": "HR-13-01-20241027",
      "name": "第50回衆議院議員総選挙 東京1区",
      "type": "HR",
      "area_code": "13-01",
      "election_date": "2024-10-27",
      "created_at": "2024-01-01T00:00:00.000Z",
      "updated_at": "2024-01-01T00:00:00.000Z"
    }
  ]
}
```

### POST /api/v1/elections

新しい選挙 ID を発行します。

**リクエスト:**

```json
{
  "name": "第50回衆議院議員総選挙 東京1区",
  "type": "HR",
  "area_code": "13-01",
  "election_date": "2024-10-27"
}
```

**レスポンス (201):**

```json
{
  "data": {
    "id": "HR-13-01-20241027",
    "name": "第50回衆議院議員総選挙 東京1区",
    "type": "HR",
    "area_code": "13-01",
    "election_date": "2024-10-27",
    "created_at": "2024-01-01T00:00:00.000Z",
    "updated_at": "2024-01-01T00:00:00.000Z"
  }
}
```

**エラー (409 Conflict):**

```json
{
  "error": "Election with this ID already exists",
  "id": "HR-13-01-20241027"
}
```

---

## 選挙 ID の形式

選挙 ID は以下の形式で自動生成されます：

```
{type}-{area_code}-{date}
```

### 構成要素

| 要素      | 説明              | 例                 |
| --------- | ----------------- | ------------------ |
| type      | 選挙タイプ        | HR, HC, PG, CM, GM |
| area_code | 選挙区コード      | 13-01 (東京 1 区)  |
| date      | 投票日 (YYYYMMDD) | 20241027           |

### 選挙タイプ

| コード | 英語名                     | 日本語名         |
| ------ | -------------------------- | ---------------- |
| HR     | House of Representatives   | 衆議院議員選挙   |
| HC     | House of Councillors       | 参議院議員選挙   |
| PG     | Prefectural Governor       | 都道府県知事選挙 |
| CM     | City/Town/Village Mayor    | 市区町村長選挙   |
| GM     | General/Municipal Assembly | 議会議員選挙     |

### 選挙区コード

形式: `{都道府県コード(2桁)}-{選挙区番号(2桁)}`

**例:**

| コード | 説明             |
| ------ | ---------------- |
| 13-01  | 東京 1 区        |
| 13-25  | 東京 25 区       |
| 27-01  | 大阪 1 区        |
| 00-00  | 比例代表（全国） |

### 特殊な選挙区（参議院合同選挙区）

| コード | 説明                 |
| ------ | -------------------- |
| 31-32  | 鳥取・島根合同選挙区 |
| 36-39  | 徳島・高知合同選挙区 |

**合同選挙区の選挙 ID 例:**

```
HC-31-32-20250720  # 参院選 鳥取・島根合同選挙区 2025年7月20日
```

---

## 今後の拡張予定

- [ ] ページネーション
- [ ] 検索 API
- [ ] 候補者と選挙の紐付け
- [ ] Ledger からの Realtime 同期エンドポイント
