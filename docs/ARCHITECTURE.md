# Polimoney Hub ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

## æ¦‚è¦

Polimoney Hub ã¯ã€Polimoney ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‡ãƒ¼ã‚¿ãƒãƒ–ã¨ã—ã¦ã€ä»¥ä¸‹ã®å½¹å‰²ã‚’æ‹…ã„ã¾ã™ï¼š

1. **å…±é€šè­˜åˆ¥å­ã®ç®¡ç†** - æ”¿æ²»å®¶ãƒ»æ”¿æ²»å›£ä½“ãƒ»é¸æŒ™ã® ID ã‚’ä¸€å…ƒç®¡ç†
2. **ãƒ‡ãƒ¼ã‚¿é€£æºã®ä»²ä»‹** - Ledger ã¨ Polimoney é–“ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã‚’åˆ¶å¾¡
3. **åŒ¿ååŒ–å‡¦ç†** - ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼è¨­å®šã«åŸºã¥ããƒ‡ãƒ¼ã‚¿å¤‰æ›
4. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥** - é«˜é »åº¦ã‚¢ã‚¯ã‚»ã‚¹ã®æœ€é©åŒ–

---

## ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Polimoney Hub                                    â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    API Server (Hono)     â”‚    â”‚      Admin UI (Fresh)            â”‚  â”‚
â”‚  â”‚                          â”‚    â”‚                                  â”‚  â”‚
â”‚  â”‚  /api/v1/* - å…¬é–‹ API    â”‚    â”‚  /login    - ãƒ­ã‚°ã‚¤ãƒ³            â”‚  â”‚
â”‚  â”‚  /api/auth/* - èªè¨¼ API  â”‚    â”‚  /         - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰      â”‚  â”‚
â”‚  â”‚  /api/admin/* - ç®¡ç† API â”‚    â”‚  /users    - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  /election-requests - æ‰¿èª       â”‚  â”‚
â”‚               â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚                                 â”‚                       â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                             â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Supabase ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (@supabase/supabase-js)        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ Supabase                                â”‚
                   â”‚                                         â”‚
                   â”‚ [Supabase Auth]                         â”‚
                   â”‚ - ç®¡ç†è€…èªè¨¼ï¼ˆEmail + Passwordï¼‰        â”‚
                   â”‚ - Magic Link æ‹›å¾…                       â”‚
                   â”‚                                         â”‚
                   â”‚ [PostgreSQL]                            â”‚
                   â”‚ - politicians, organizations, elections â”‚
                   â”‚ - public_ledgers, public_journals       â”‚
                   â”‚ - admin_users (ç®¡ç†è€…)                  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Polimoney ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“å›³

> âš ï¸ **é‡è¦**: Ledger ã¨ Hub ã¯ **åˆ¥ã€…ã® Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ** ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
> æ··åŒã—ãªã„ã‚ˆã†ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DD2030 SaaS                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                        Polimoney Hub                                    â”‚â”‚
â”‚  â”‚  - å…±é€šè­˜åˆ¥å­ç®¡ç† (æ”¿æ²»å®¶/æ”¿æ²»å›£ä½“/é¸æŒ™)                                â”‚â”‚
â”‚  â”‚  - ãƒ‡ãƒ¼ã‚¿é€£æºãƒ»åŒ¿ååŒ–                                                   â”‚â”‚
â”‚  â”‚  - ç®¡ç†ç”»é¢ (Fresh)                                                     â”‚â”‚
â”‚  â”‚                                                                          â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
â”‚  â”‚  â”‚ ğŸ…±ï¸ Supabase Project B (Hub å°‚ç”¨)                               â”‚    â”‚â”‚
â”‚  â”‚  â”‚    - PostgreSQL: politicians, organizations, elections         â”‚    â”‚â”‚
â”‚  â”‚  â”‚    - PostgreSQL: public_ledgers, public_journals, admin_users  â”‚    â”‚â”‚
â”‚  â”‚  â”‚    - Supabase Auth: ç®¡ç†è€…èªè¨¼                                 â”‚    â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â”‚ API (X-API-Key)                              â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚          â”‚                                       â”‚                         â”‚
â”‚          â–¼                                       â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Polimoney Ledger               â”‚      â”‚ Polimoney     â”‚                â”‚
â”‚  â”‚ (æ”¿æ²»å®¶å‘ã‘åæ”¯ç®¡ç†)           â”‚      â”‚ (å¯è¦–åŒ–)      â”‚                â”‚
â”‚  â”‚                                â”‚      â”‚               â”‚                â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                â”‚
â”‚  â”‚  â”‚ ğŸ…°ï¸ Supabase Project A     â”‚  â”‚      â”‚ â”‚ Next.js   â”‚ â”‚                â”‚
â”‚  â”‚  â”‚    (Ledger å°‚ç”¨)          â”‚  â”‚      â”‚ â”‚ - åæ”¯è¡¨ç¤ºâ”‚ â”‚                â”‚
â”‚  â”‚  â”‚    - PostgreSQL: journals â”‚  â”‚      â”‚ â”‚ - æ¯”è¼ƒ    â”‚ â”‚                â”‚
â”‚  â”‚  â”‚    - PostgreSQL: contacts â”‚  â”‚      â”‚ â”‚ - åˆ†æ    â”‚ â”‚                â”‚
â”‚  â”‚  â”‚    - Supabase Auth: OTP   â”‚  â”‚      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                â”‚
â”‚  â”‚  â”‚    - Supabase Storage     â”‚  â”‚      â”‚               â”‚                â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                      å°†æ¥ã®æ¶ˆè²»è€…                                       â”‚â”‚
â”‚  â”‚  - å¸‚æ°‘å‘ã‘ã‚¢ãƒ—ãƒª                                                       â”‚â”‚
â”‚  â”‚  - ç ”ç©¶è€…å‘ã‘ API                                                       â”‚â”‚
â”‚  â”‚  - ãƒ¡ãƒ‡ã‚£ã‚¢å‘ã‘ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰                                           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆ†é›¢

| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ               | ç”¨é€”                           | ç’°å¢ƒå¤‰æ•°ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹       |
| -------------------------- | ------------------------------ | ---------------------------- |
| **ğŸ…°ï¸ Supabase A (Ledger)** | æ”¿æ²»å®¶ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿     | `SUPABASE_` (Ledger ã® .env) |
| **ğŸ…±ï¸ Supabase B (Hub)**    | å…±é€šè­˜åˆ¥å­ãƒ»å…¬é–‹ãƒ‡ãƒ¼ã‚¿ãƒ»ç®¡ç†è€… | `SUPABASE_` (Hub ã® .env)    |

**ãªãœåˆ†é›¢ã™ã‚‹ã‹:**

- Ledger: æ”¿æ²»å®¶ã®å€‹äººæƒ…å ±ãƒ»é ˜åæ›¸ãªã©æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†
- Hub: å…¬é–‹ãƒ‡ãƒ¼ã‚¿ãƒ»å…±é€šè­˜åˆ¥å­ã‚’æ‰±ã†ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¢ƒç•Œã‚’åˆ†ã‘ã‚‹ï¼‰

### å…±é€šè­˜åˆ¥å­ã®ç®¡ç†æ–¹é‡ï¼ˆé‡è¦ï¼‰

> âš ï¸ **Hub ã¯å…±é€šè­˜åˆ¥å­ã®å”¯ä¸€ã®æƒ…å ±æº (Single Source of Truth) ã§ã™ã€‚**
>
> Ledger ã‚„ Polimoney ã¯å…±é€šè­˜åˆ¥å­ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ **ã—ã¾ã›ã‚“**ã€‚
> å¿…è¦ãªã¨ãã« Hub API ã‹ã‚‰å–å¾—ã—ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§æ€§èƒ½ã‚’æ‹…ä¿ã—ã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ…±ï¸ Hub (Supabase B)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ å…±é€šè­˜åˆ¥å­ï¼ˆSingle Source of Truthï¼‰                          â”‚ â”‚
â”‚  â”‚ - politicians (æ”¿æ²»å®¶)                                        â”‚ â”‚
â”‚  â”‚ - organizations (æ”¿æ²»å›£ä½“)                                    â”‚ â”‚
â”‚  â”‚ - elections (é¸æŒ™)                                            â”‚ â”‚
â”‚  â”‚ â€» Ledger/Polimoney ã¯ã“ã“ã‹ã‚‰ã®ã¿å–å¾—                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    Hub API (èªè¨¼: X-API-Key)
                                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                         â”‚                         â”‚
        â–¼                         â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ledger        â”‚         â”‚ Polimoney     â”‚         â”‚ å°†æ¥ã®æ¶ˆè²»è€…  â”‚
â”‚ (ã‚­ãƒ£ãƒƒã‚·ãƒ¥)  â”‚         â”‚ (å¯è¦–åŒ–)      â”‚         â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ…°ï¸ Ledger (Supabase A)                         â”‚
â”‚  - journals ã« election_id, organization_id ã‚’ UUID ã§å‚ç…§       â”‚
â”‚  - elections/organizations/politicians ãƒ†ãƒ¼ãƒ–ãƒ«ã¯å­˜åœ¨ã—ãªã„      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ã“ã®æ–¹é‡ã®ç†ç”±:**

| ç†ç”± | èª¬æ˜ |
|------|------|
| ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ | äºŒé‡ç®¡ç†ã«ã‚ˆã‚‹ä¸æ•´åˆã‚’é˜²æ­¢ |
| ã‚·ãƒ³ãƒ—ãƒ«ã• | åŒæœŸãƒ­ã‚¸ãƒƒã‚¯ãŒä¸è¦ |
| å¯ç”¨æ€§ | Hub ãŒãƒ€ã‚¦ãƒ³ = 3ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆå…¨ä½“ãŒãƒ€ã‚¦ãƒ³ï¼ˆè¨±å®¹ï¼‰|
| æ€§èƒ½ | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§ååˆ†ï¼ˆå…±é€šè­˜åˆ¥å­ã¯é »ç¹ã«å¤‰ã‚ã‚‰ãªã„ï¼‰|

---

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 1. æ–°è¦ç™»éŒ²ãƒ•ãƒ­ãƒ¼ï¼ˆæ”¿æ²»å®¶ ID ç™ºè¡Œï¼‰

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼ â†’ Ledger â†’ Hub API â†’ ğŸ…±ï¸ Supabase B (Hub)
                                    â”‚
                                    â””â†’ æ”¿æ²»å®¶ ID (UUID) ã‚’ç™ºè¡Œãƒ»ä¿å­˜
                                    â”‚
              â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              æ”¿æ²»å®¶ ID ã‚’ Ledger ã«è¿”å´
              ï¼ˆLedger ã¯ ğŸ…°ï¸ Supabase A ã«ä¿å­˜ï¼‰
```

### 2. ä»•è¨³ãƒ‡ãƒ¼ã‚¿é€£æºï¼ˆLedger â†’ Hub åŒæœŸï¼‰

```
ğŸ…°ï¸ Supabase A (Ledger DB)
     â”‚ journals, contacts, etc.
     â”‚
     â–¼
Polimoney Ledger
     â”‚ ä»•è¨³ã‚’å…¬é–‹ã™ã‚‹éš›ã« Hub API ã‚’å‘¼ã³å‡ºã—
     â”‚ POST /api/v1/sync (API Key èªè¨¼)
     â–¼
Polimoney Hub
     â”‚ åŒ¿ååŒ–å‡¦ç† (is_name_private ç­‰)
     â”‚ ãƒãƒƒã‚·ãƒ¥ç”Ÿæˆï¼ˆæ”¹ã–ã‚“æ¤œçŸ¥ç”¨ï¼‰
     â–¼
ğŸ…±ï¸ Supabase B (Hub DB)
     â”‚ public_ledgers, public_journals
     â–¼
Polimoney (å¯è¦–åŒ–) / ä»–ã®æ¶ˆè²»è€…
```

### 3. ã‚µãƒ¼ãƒ“ã‚¹é–“ã®èªè¨¼

| é€šä¿¡çµŒè·¯               | èªè¨¼æ–¹å¼             | èª¬æ˜                                    |
| ---------------------- | -------------------- | --------------------------------------- |
| Ledger â†’ Hub API       | `X-API-Key` ãƒ˜ãƒƒãƒ€ãƒ¼ | ç’°å¢ƒå¤‰æ•° `API_KEY_PROD` / `API_KEY_DEV` |
| Hub Admin UI â†’ Hub API | Bearer Token (JWT)   | ğŸ…±ï¸ Supabase B ã® Auth ã§ç™ºè¡Œ            |
| Ledger UI â†’ Ledger API | Bearer Token (JWT)   | ğŸ…°ï¸ Supabase A ã® Auth ã§ç™ºè¡Œ            |

### 3. ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ•ãƒ­ãƒ¼

```
Polimoney (å¯è¦–åŒ–)
     â”‚
     â”‚ GET /api/v1/journals (äºˆå®š)
     â–¼
Polimoney Hub
     â”‚
     â””â”€â†’ Hub Supabase: æ”¿æ²»å®¶åãƒ»é¸æŒ™æƒ…å ±ãƒ»å…¬é–‹ä»•è¨³ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
```

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ãƒ¬ã‚¤ãƒ¤ãƒ¼           | æŠ€è¡“                  | ç†ç”±                                   |
| ------------------ | --------------------- | -------------------------------------- |
| ãƒ©ãƒ³ã‚¿ã‚¤ãƒ          | Deno                  | TypeScript ãƒã‚¤ãƒ†ã‚£ãƒ–ã€ã‚»ã‚­ãƒ¥ã‚¢        |
| API ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | Hono                  | è»½é‡ã€Edge æœ€é©åŒ–                      |
| ç®¡ç†ç”»é¢           | Fresh                 | Deno ãƒã‚¤ãƒ†ã‚£ãƒ–ã€SSR                   |
| DB ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ    | @supabase/supabase-js | èªè¨¼çµ±åˆã€RLS å¯¾å¿œ                     |
| ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°       | Deno Deploy           | ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒƒã‚¸ã€ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆé«˜é€Ÿ |
| DB                 | Supabase (PostgreSQL) | èªè¨¼ãƒ»RLS çµ±åˆã€ç„¡æ–™æ å……å®Ÿ             |
| èªè¨¼               | Supabase Auth         | JWTã€Magic Linkã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼        |

---

## èªè¨¼ãƒ»èªå¯

### ã‚µãƒ¼ãƒ“ã‚¹é–“èªè¨¼ï¼ˆAPIï¼‰

| é€šä¿¡            | èªè¨¼æ–¹å¼                               |
| --------------- | -------------------------------------- |
| Ledger â†’ Hub    | API Key (`X-API-Key` ãƒ˜ãƒƒãƒ€ãƒ¼)         |
| Polimoney â†’ Hub | API Key (`X-API-Key` ãƒ˜ãƒƒãƒ€ãƒ¼)         |
| Hub â†’ Supabase  | Service Role Keyï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ã¿ï¼‰ |

### ç®¡ç†ç”»é¢èªè¨¼ï¼ˆSupabase Authï¼‰

| æ©Ÿèƒ½           | æ–¹å¼                                    |
| -------------- | --------------------------------------- |
| ç®¡ç†è€…æ‹›å¾…     | `inviteUserByEmail()` â†’ Magic Link      |
| ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š | æ‹›å¾…ãƒªãƒ³ã‚¯ã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šç”»é¢ã¸      |
| é€šå¸¸ãƒ­ã‚°ã‚¤ãƒ³   | Email + Password (`signInWithPassword`) |
| ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¿˜ã‚Œ | Magic Link (`resetPasswordForEmail`)    |

### ç’°å¢ƒå¤‰æ•°

```
# Supabase æ¥ç¶š
SUPABASE_URL=https://xxxxx.supabase.co
SUPABASE_PUBLISHABLE_KEY=eyJhbGci...  # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨
SUPABASE_SECRET_KEY=eyJhbGci...       # ã‚µãƒ¼ãƒãƒ¼ç”¨ï¼ˆå…¬é–‹å³ç¦ï¼‰

# API èªè¨¼ã‚­ãƒ¼ï¼ˆLedger/Polimoney ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ç”¨ï¼‰
API_KEY_PROD=your-production-api-key
API_KEY_DEV=your-development-api-key
```

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
polimoney_hub/
â”œâ”€â”€ src/                          # API ã‚µãƒ¼ãƒãƒ¼ (Hono)
â”‚   â”œâ”€â”€ index.ts                  # ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ politicians.ts        # æ”¿æ²»å®¶ API         âœ… å®Ÿè£…æ¸ˆ
â”‚   â”‚   â”œâ”€â”€ organizations.ts      # æ”¿æ²»å›£ä½“ API       âœ… å®Ÿè£…æ¸ˆ
â”‚   â”‚   â”œâ”€â”€ elections.ts          # é¸æŒ™ API           âœ… å®Ÿè£…æ¸ˆ
â”‚   â”‚   â”œâ”€â”€ auth.ts               # èªè¨¼ API           âœ… å®Ÿè£…æ¸ˆ
â”‚   â”‚   â”œâ”€â”€ admin.ts              # ç®¡ç† API           âœ… å®Ÿè£…æ¸ˆ
â”‚   â”‚   â”œâ”€â”€ sync.ts               # åŒæœŸ API           âœ… å®Ÿè£…æ¸ˆ
â”‚   â”‚   â””â”€â”€ ledgers.ts            # å…¬é–‹å°å¸³ API       â³ äºˆå®š
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â””â”€â”€ client.ts             # Supabase ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â””â”€â”€ supabase.ts           # Supabase ãƒ˜ãƒ«ãƒ‘ãƒ¼
â”‚   â””â”€â”€ middleware/
â”‚       â”œâ”€â”€ auth.ts               # API Key èªè¨¼
â”‚       â””â”€â”€ admin-auth.ts         # ç®¡ç†è€…èªè¨¼
â”œâ”€â”€ admin/                        # ç®¡ç†ç”»é¢ (Fresh)
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ index.tsx             # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰     âœ… å®Ÿè£…æ¸ˆ
â”‚   â”‚   â”œâ”€â”€ login.tsx             # ãƒ­ã‚°ã‚¤ãƒ³           â³ å®Ÿè£…ä¸­
â”‚   â”‚   â”œâ”€â”€ users/                # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†       â³ äºˆå®š
â”‚   â”‚   â”œâ”€â”€ election-requests/    # é¸æŒ™ãƒªã‚¯ã‚¨ã‚¹ãƒˆ     âœ… å®Ÿè£…æ¸ˆ
â”‚   â”‚   â””â”€â”€ organization-requests/# å›£ä½“ãƒªã‚¯ã‚¨ã‚¹ãƒˆ     âœ… å®Ÿè£…æ¸ˆ
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ Layout.tsx            # å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â””â”€â”€ lib/
â”‚       â””â”€â”€ auth.ts               # èªè¨¼ãƒ˜ãƒ«ãƒ‘ãƒ¼
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ schema-supabase.sql       # Supabase ã‚¹ã‚­ãƒ¼ãƒ
â”‚   â””â”€â”€ seed-supabase.ts          # ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ API.md                    # API ä»•æ§˜
â”‚   â””â”€â”€ ARCHITECTURE.md           # æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ deno.json
â””â”€â”€ README.md
```

---

## å…¬é–‹ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–

### è¨­è¨ˆæ–¹é‡

Polimoney ãŒãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹éš›ã€æ¯å› Ledger DB ã«ã‚¯ã‚¨ãƒªã™ã‚‹ã®ã¯éåŠ¹ç‡ã§ã™ã€‚
ãã®ãŸã‚ã€Hub (Supabase) ã«**å…¬é–‹ç”¨ãƒ‡ãƒ¼ã‚¿ã‚’æ°¸ç¶šä¿å­˜**ã—ã€Ledger DB ã¸ã®è² è·ã‚’ã‚¼ãƒ­ã«ã—ã¾ã™ã€‚

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ledger DB       â”‚ â† æ”¿æ²»å®¶ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆï¼‰
â”‚ (Supabase)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ API çµŒç”±ã§åŒæœŸ
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Hub             â”‚
â”‚ - åŒ¿ååŒ–        â”‚
â”‚ - ãƒãƒƒã‚·ãƒ¥ç”Ÿæˆ  â”‚
â”‚ - å¤‰æ›´æ¤œçŸ¥      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Hub Supabase    â”‚ â† å…¬é–‹ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šä¿å­˜
â”‚ - public_ledgersâ”‚    Ledger DB ã¸ã®è² è·ã‚¼ãƒ­
â”‚ - public_journalsâ”‚
â”‚ - change_logs   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Polimoney       â”‚ â† Hub Supabase ã‹ã‚‰ã®ã¿å–å¾—
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å¤‰æ›´å±¥æ­´ã¨é€æ˜æ€§

### èª²é¡Œ

æ”¿æ²»å®¶ãŒéå»ã®å°å¸³ã‚’ã“ã£ãã‚Šå¤‰æ›´ã—ã¦ã‚‚èª°ã‚‚æ°—ã¥ã‘ãªã„ â†’ ä¸å¥å…¨

### è§£æ±ºç­–: ãƒãƒƒã‚·ãƒ¥ + å°å¸³ãƒ¬ãƒ™ãƒ«ã®å¤‰æ›´ãƒ­ã‚°

1. ä»•è¨³ç™»éŒ²æ™‚ã«**ãƒãƒƒã‚·ãƒ¥**ã‚’ç”Ÿæˆãƒ»ä¿å­˜ï¼ˆæ”¹ã–ã‚“æ¤œçŸ¥ç”¨ï¼‰
2. **å°å¸³ãƒ¬ãƒ™ãƒ«**ã§å¤‰æ›´ãƒ­ã‚°ã‚’ä¿å­˜ï¼ˆä»•è¨³ã”ã¨ã ã¨å¤šã™ãã‚‹ï¼‰
3. Polimoney ã§ã€Œæœ€çµ‚æ›´æ–°æ—¥æ™‚ã€ã¨ã€Œå¤‰æ›´å±¥æ­´ã€ã‚’è¡¨ç¤º

### ã‚¹ã‚­ãƒ¼ãƒ

```sql
-- å…¬é–‹ç”¨å°å¸³ï¼ˆ1å¹´åˆ†ã®åæ”¯å ±å‘Šï¼‰
CREATE TABLE public_ledgers (
    id UUID PRIMARY KEY,
    politician_id UUID NOT NULL REFERENCES politicians(id),
    election_id VARCHAR(50) REFERENCES elections(id),
    fiscal_year INTEGER NOT NULL,
    total_income INTEGER DEFAULT 0,
    total_expense INTEGER DEFAULT 0,
    journal_count INTEGER DEFAULT 0,
    last_updated_at TIMESTAMPTZ NOT NULL,
    first_synced_at TIMESTAMPTZ NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- å…¬é–‹ç”¨ä»•è¨³
CREATE TABLE public_journals (
    id UUID PRIMARY KEY,
    ledger_id UUID NOT NULL REFERENCES public_ledgers(id),
    date DATE NOT NULL,
    description TEXT,
    amount INTEGER NOT NULL,
    contact_name TEXT,
    contact_type VARCHAR(20),
    content_hash VARCHAR(64) NOT NULL,
    synced_at TIMESTAMPTZ NOT NULL
);

-- å°å¸³ãƒ¬ãƒ™ãƒ«ã®å¤‰æ›´ãƒ­ã‚°
CREATE TABLE ledger_change_logs (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    ledger_id UUID REFERENCES public_ledgers(id),
    changed_at TIMESTAMPTZ NOT NULL,
    change_summary TEXT  -- "ä»•è¨³3ä»¶ã‚’è¿½åŠ ", "ä»•è¨³ã‚’ä¿®æ­£" ç­‰
);
```

### Polimoney ã§ã®è¡¨ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å±±ç”°å¤ªéƒ - 2024å¹´åº¦ åæ”¯å ±å‘Šæ›¸                              â”‚
â”‚                                                              â”‚
â”‚ æœ€çµ‚æ›´æ–°: 2024/03/01 10:30  ğŸ“‹ å¤‰æ›´å±¥æ­´                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [åå…¥ãƒ“ãƒ¥ãƒ¼] [æ”¯å‡ºãƒ“ãƒ¥ãƒ¼] [ç§‘ç›®åˆ¥] [æœˆåˆ¥æ¨ç§»]              â”‚
â”‚  ...                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¤‰æ›´å±¥æ­´ãƒ“ãƒ¥ãƒ¼ï¼ˆ2 éšå±¤ï¼‰

**Level 1: å¤‰æ›´ä¸€è¦§**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ å¤‰æ›´å±¥æ­´                                        âœ• é–‰ã˜ã‚‹â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“… 2024/03/01 10:30  ä»•è¨³1ä»¶ã‚’ä¿®æ­£           â–¶ è©³ç´°       â”‚
â”‚  ğŸ“… 2024/02/25 14:15  ä»•è¨³2ä»¶ã‚’è¿½åŠ            â–¶ è©³ç´°       â”‚
â”‚  ğŸ“… 2024/01/20 09:00  åˆå›åŒæœŸï¼ˆ15ä»¶ï¼‰                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Level 2: å¤‰æ›´è©³ç´°ï¼ˆæ—¥ä»˜ã‚¯ãƒªãƒƒã‚¯å¾Œï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ å¤‰æ›´å±¥æ­´ > 2024/03/01 10:30                   â—€ æˆ»ã‚‹    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  âœš è¿½åŠ ã•ã‚ŒãŸä»•è¨³                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  2024/02/20  äº‹å‹™æ‰€è³ƒæ–™      Â¥80,000                        â”‚
â”‚  2024/02/15  äº¤é€šè²»          Â¥5,000                         â”‚
â”‚                                                              â”‚
â”‚  âœ ä¿®æ­£ã•ã‚ŒãŸä»•è¨³                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  2024/01/15  ãƒã‚¹ã‚¿ãƒ¼å°åˆ·                                   â”‚
â”‚    â€¢ é‡‘é¡: Â¥50,000 â†’ Â¥30,000                               â”‚
â”‚    â€¢ æ‘˜è¦: ãƒã‚¹ã‚¿ãƒ¼å°åˆ· â†’ ãƒãƒ©ã‚·å°åˆ·                       â”‚
â”‚                                                              â”‚
â”‚  ğŸ—‘ å‰Šé™¤ã•ã‚ŒãŸä»•è¨³                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ï¼ˆãªã—ï¼‰                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### change_details ã®å½¢å¼

```json
{
  "added": [
    {
      "id": "uuid",
      "date": "2024-02-20",
      "description": "äº‹å‹™æ‰€è³ƒæ–™",
      "amount": 80000
    }
  ],
  "modified": [
    {
      "id": "uuid",
      "date": "2024-01-15",
      "description": "ãƒã‚¹ã‚¿ãƒ¼å°åˆ·",
      "changes": {
        "amount": { "before": 50000, "after": 30000 },
        "description": { "before": "ãƒã‚¹ã‚¿ãƒ¼å°åˆ·", "after": "ãƒãƒ©ã‚·å°åˆ·" }
      }
    }
  ],
  "deleted": [
    {
      "id": "uuid",
      "date": "2024-01-10",
      "description": "å‰Šé™¤ã•ã‚ŒãŸä»•è¨³",
      "amount": 10000
    }
  ]
}
```

### å·®åˆ†ä¿å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

é€æ˜æ€§ã®ãŸã‚ã€é‡è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å·®åˆ†ï¼ˆbefore/afterï¼‰ã‚’ä¿å­˜ï¼š

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰     | ä¿å­˜ | ç†ç”±             |
| -------------- | ---- | ---------------- |
| `amount`       | âœ…   | é‡‘é¡å¤‰æ›´ã¯é‡è¦   |
| `description`  | âœ…   | æ‘˜è¦å¤‰æ›´ã¯é‡è¦   |
| `contact_name` | âœ…   | æ”¯å‡ºå…ˆå¤‰æ›´ã¯é‡è¦ |
| `date`         | âœ…   | æ—¥ä»˜å¤‰æ›´ã¯æ€ªã—ã„ |
| `account_code` | âŒ   | ç§‘ç›®å¤‰æ›´ã¯ç¨€     |

---

## ä»Šå¾Œã®æ‹¡å¼µ

### Phase 1: åŸºç›¤æ§‹ç¯‰ âœ…

- [x] æ”¿æ²»å®¶ / æ”¿æ²»å›£ä½“ / é¸æŒ™ API
- [x] API Key èªè¨¼
- [x] Supabase æ¥ç¶š
- [x] Supabase Auth çµ±åˆ

### Phase 2: ç®¡ç†ç”»é¢ ğŸ”„ é€²è¡Œä¸­

- [x] ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- [x] é¸æŒ™ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ‰¿èªç”»é¢
- [x] å›£ä½“ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ‰¿èªç”»é¢
- [ ] ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ç”»é¢

### Phase 3: å…¬é–‹ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–

- [x] public_ledgers / public_journals ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [x] ledger_change_logs ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [ ] ãƒãƒƒã‚·ãƒ¥ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…

### Phase 4: Ledger é€£æº

- [x] åŒæœŸ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- [ ] åŒ¿ååŒ–å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯
- [ ] Ledger â†” Hub è‡ªå‹•åŒæœŸ

### Phase 5: Polimoney é€£æº

- [ ] å…¬é–‹å°å¸³ API (`/api/v1/public-ledgers`)
- [ ] å¤‰æ›´å±¥æ­´ API (`/api/v1/ledgers/:id/changes`)
- [ ] ç›£æŸ»ãƒ­ã‚°

### Phase 6: æ‹¡å¼µ

- [ ] å¸‚æ°‘å‘ã‘ã‚¢ãƒ—ãƒªå¯¾å¿œ
- [ ] ç ”ç©¶è€…å‘ã‘ API
- [ ] OpenAPI / Swagger ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
