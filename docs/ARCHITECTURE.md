# Polimoney Hub ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

## æ¦‚è¦

Polimoney Hub ã¯ã€Polimoney ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‡ãƒ¼ã‚¿ãƒãƒ–ã¨ã—ã¦ã€ä»¥ä¸‹ã®å½¹å‰²ã‚’æ‹…ã„ã¾ã™ï¼š

1. **å…±é€šè­˜åˆ¥å­ã®ç®¡ç†** - æ”¿æ²»å®¶ãƒ»æ”¿æ²»å›£ä½“ãƒ»é¸æŒ™ã® ID ã‚’ä¸€å…ƒç®¡ç†
2. **ãƒ‡ãƒ¼ã‚¿é€£æºã®ä»²ä»‹** - Ledger ã¨ Polimoney é–“ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã‚’åˆ¶å¾¡
3. **åŒ¿ååŒ–å‡¦ç†** - ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼è¨­å®šã«åŸºã¥ããƒ‡ãƒ¼ã‚¿å¤‰æ›
4. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥** - é«˜é »åº¦ã‚¢ã‚¯ã‚»ã‚¹ã®æœ€é©åŒ–

---

## ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Polimoney Hub                                    â”‚
â”‚                         (Deno + Hono)                                    â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å…±é€šè­˜åˆ¥å­ API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€ å…¬é–‹ãƒ‡ãƒ¼ã‚¿ API â”€â”€â”€â”
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â”‚Politicians â”‚ â”‚Organizations â”‚ â”‚Elections â”‚ â”‚  â”‚ â”‚ Public Ledgers â”‚  â”‚
â”‚  â”‚ â”‚ API        â”‚ â”‚ API          â”‚ â”‚ API      â”‚ â”‚  â”‚ â”‚ API            â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚ Public Journalsâ”‚  â”‚
â”‚                         â”‚                          â”‚ â”‚ API            â”‚  â”‚
â”‚                         â”‚                          â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚                         â”‚                          â”‚ â”‚ Change Logs    â”‚  â”‚
â”‚                         â”‚                          â”‚ â”‚ API            â”‚  â”‚
â”‚                         â”‚                          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                         â”‚                                     â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                       â–¼
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     API Key èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                       â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     DB ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (postgres)                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ Azure PostgreSQL                        â”‚
                   â”‚                                         â”‚
                   â”‚ [å…±é€šè­˜åˆ¥å­ãƒã‚¹ã‚¿]                      â”‚
                   â”‚ - politicians                           â”‚
                   â”‚ - organizations                         â”‚
                   â”‚ - elections                             â”‚
                   â”‚                                         â”‚
                   â”‚ [å…¬é–‹ãƒ‡ãƒ¼ã‚¿]                            â”‚
                   â”‚ - public_ledgers      (å…¬é–‹ç”¨å°å¸³)      â”‚
                   â”‚ - public_journals     (å…¬é–‹ç”¨ä»•è¨³)      â”‚
                   â”‚ - ledger_change_logs  (å¤‰æ›´å±¥æ­´)        â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Polimoney ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DD2030 SaaS                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        Polimoney Hub                              â”‚  â”‚
â”‚  â”‚  - å…±é€šè­˜åˆ¥å­ç®¡ç† (æ”¿æ²»å®¶/æ”¿æ²»å›£ä½“/é¸æŒ™)                          â”‚  â”‚
â”‚  â”‚  - ãƒ‡ãƒ¼ã‚¿é€£æºãƒ»åŒ¿ååŒ–                                             â”‚  â”‚
â”‚  â”‚  - ã‚­ãƒ£ãƒƒã‚·ãƒ¥å±¤                                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                          â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚          â”‚                   â”‚                   â”‚                     â”‚
â”‚          â–¼                   â–¼                   â–¼                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Polimoney     â”‚   â”‚ Azure DB      â”‚   â”‚ Polimoney     â”‚            â”‚
â”‚  â”‚ Ledger        â”‚   â”‚ (PostgreSQL)  â”‚   â”‚ (å¯è¦–åŒ–)      â”‚            â”‚
â”‚  â”‚               â”‚   â”‚               â”‚   â”‚               â”‚            â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚            â”‚
â”‚  â”‚ â”‚ Supabase  â”‚ â”‚   â”‚ â”‚politiciansâ”‚ â”‚   â”‚ â”‚ Frontend  â”‚ â”‚            â”‚
â”‚  â”‚ â”‚ - Auth    â”‚ â”‚   â”‚ â”‚orgs       â”‚ â”‚   â”‚ â”‚ - åæ”¯è¡¨ç¤ºâ”‚ â”‚            â”‚
â”‚  â”‚ â”‚ - DB      â”‚ â”‚   â”‚ â”‚elections  â”‚ â”‚   â”‚ â”‚ - æ¯”è¼ƒ    â”‚ â”‚            â”‚
â”‚  â”‚ â”‚ - Storage â”‚ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â”‚ - åˆ†æ    â”‚ â”‚            â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      å°†æ¥ã®æ¶ˆè²»è€…                                 â”‚  â”‚
â”‚  â”‚  - å¸‚æ°‘å‘ã‘ã‚¢ãƒ—ãƒª                                                 â”‚  â”‚
â”‚  â”‚  - ç ”ç©¶è€…å‘ã‘ API                                                 â”‚  â”‚
â”‚  â”‚  - ãƒ¡ãƒ‡ã‚£ã‚¢å‘ã‘ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 1. æ–°è¦ç™»éŒ²ãƒ•ãƒ­ãƒ¼ï¼ˆæ”¿æ²»å®¶ ID ç™ºè¡Œï¼‰

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼ â†’ Ledger â†’ Hub â†’ Azure DB
                          â”‚
                          â””â†’ æ”¿æ²»å®¶ ID (UUID) ã‚’ç™ºè¡Œãƒ»ä¿å­˜
                          â”‚
           â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           æ”¿æ²»å®¶ ID ã‚’ Ledger ã«è¿”å´
```

### 2. ä»•è¨³ãƒ‡ãƒ¼ã‚¿é€£æºï¼ˆRealtimeï¼‰

```
Ledger DB (Supabase)
     â”‚
     â”‚ Supabase Realtime (postgres_changes)
     â–¼
Polimoney Hub
     â”‚
     â”‚ åŒ¿ååŒ–å‡¦ç† (is_name_private ç­‰)
     â”‚ ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°
     â–¼
Polimoney (å¯è¦–åŒ–) / ä»–ã®æ¶ˆè²»è€…
```

### 3. ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ•ãƒ­ãƒ¼

```
Polimoney (å¯è¦–åŒ–)
     â”‚
     â”‚ GET /api/v1/journals (äºˆå®š)
     â–¼
Polimoney Hub
     â”‚
     â”œâ”€â†’ Azure DB: æ”¿æ²»å®¶åãƒ»é¸æŒ™æƒ…å ±ã‚’å–å¾—
     â”‚
     â””â”€â†’ Ledger DB (Supabase): ä»•è¨³ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            â€» ç›´æ¥å‚ç…§ or API çµŒç”±
```

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ãƒ¬ã‚¤ãƒ¤ãƒ¼        | æŠ€è¡“                | ç†ç”±                                   |
| --------------- | ------------------- | -------------------------------------- |
| ãƒ©ãƒ³ã‚¿ã‚¤ãƒ       | Deno                | TypeScript ãƒã‚¤ãƒ†ã‚£ãƒ–ã€ã‚»ã‚­ãƒ¥ã‚¢        |
| ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯  | Hono                | è»½é‡ã€Edge æœ€é©åŒ–                      |
| DB ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ | deno-postgres       | Deno ãƒã‚¤ãƒ†ã‚£ãƒ–                        |
| ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°    | Deno Deploy         | ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒƒã‚¸ã€ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆé«˜é€Ÿ |
| DB              | Azure PostgreSQL    | Polimoney ã¨ã®å…±æœ‰ã€åœ°ç†çš„é…ç½®         |
| ã‚­ãƒ£ãƒƒã‚·ãƒ¥      | Redis (Azure Cache) | å°†æ¥è¿½åŠ äºˆå®š                           |

---

## èªè¨¼ãƒ»èªå¯

### ã‚µãƒ¼ãƒ“ã‚¹é–“èªè¨¼

| é€šä¿¡            | èªè¨¼æ–¹å¼                                 |
| --------------- | ---------------------------------------- |
| Ledger â†’ Hub    | API Key + IP åˆ¶é™                        |
| Hub â†’ Azure DB  | æ¥ç¶šæ–‡å­—åˆ— (SSL å¿…é ˆ)                    |
| Hub â†’ Ledger DB | API Key ã¾ãŸã¯ Supabase Service Role Key |
| Polimoney â†’ Hub | API Key + IP åˆ¶é™                        |

### API Key ç®¡ç†

```
ç’°å¢ƒå¤‰æ•°:
- API_KEY: ãƒ¡ã‚¤ãƒ³ API ã‚­ãƒ¼
- LEDGER_API_KEY: Ledger å°‚ç”¨ã‚­ãƒ¼ï¼ˆå°†æ¥ï¼‰
- POLIMONEY_API_KEY: Polimoney å°‚ç”¨ã‚­ãƒ¼ï¼ˆå°†æ¥ï¼‰
```

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
polimoney_hub/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ politicians.ts    # æ”¿æ²»å®¶ API         âœ… å®Ÿè£…æ¸ˆ
â”‚   â”‚   â”œâ”€â”€ organizations.ts  # æ”¿æ²»å›£ä½“ API       âœ… å®Ÿè£…æ¸ˆ
â”‚   â”‚   â”œâ”€â”€ elections.ts      # é¸æŒ™ API           âœ… å®Ÿè£…æ¸ˆ
â”‚   â”‚   â”œâ”€â”€ ledgers.ts        # å…¬é–‹å°å¸³ API       â³ äºˆå®š
â”‚   â”‚   â”œâ”€â”€ journals.ts       # å…¬é–‹ä»•è¨³ API       â³ äºˆå®š
â”‚   â”‚   â”œâ”€â”€ changes.ts        # å¤‰æ›´å±¥æ­´ API       â³ äºˆå®š
â”‚   â”‚   â””â”€â”€ sync.ts           # Realtime åŒæœŸ      â³ äºˆå®š
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â””â”€â”€ client.ts         # DB æ¥ç¶š
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â””â”€â”€ auth.ts           # èªè¨¼
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ anonymize.ts      # åŒ¿ååŒ–ãƒ­ã‚¸ãƒƒã‚¯     â³ äºˆå®š
â”‚       â””â”€â”€ hash.ts           # ãƒãƒƒã‚·ãƒ¥ç”Ÿæˆ       â³ äºˆå®š
â”œâ”€â”€ db/
â”‚   â””â”€â”€ schema.sql            # Azure DB ã‚¹ã‚­ãƒ¼ãƒ
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ API.md                # API ä»•æ§˜
â”‚   â””â”€â”€ ARCHITECTURE.md       # æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ deno.json
â””â”€â”€ README.md
```

---

## å…¬é–‹ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–

### è¨­è¨ˆæ–¹é‡

Polimoney ãŒãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹éš›ã€æ¯å› Ledger DB (Supabase) ã«ã‚¯ã‚¨ãƒªã™ã‚‹ã®ã¯éåŠ¹ç‡ã§ã™ã€‚
ãã®ãŸã‚ã€Hub (Azure DB) ã«**å…¬é–‹ç”¨ãƒ‡ãƒ¼ã‚¿ã‚’æ°¸ç¶šä¿å­˜**ã—ã€Ledger DB ã¸ã®è² è·ã‚’ã‚¼ãƒ­ã«ã—ã¾ã™ã€‚

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ledger DB       â”‚ â† æ”¿æ²»å®¶ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆï¼‰
â”‚ (Supabase)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Realtime (å¤‰æ›´æ™‚ã®ã¿)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Hub             â”‚
â”‚ - åŒ¿ååŒ–        â”‚
â”‚ - ãƒãƒƒã‚·ãƒ¥ç”Ÿæˆ  â”‚
â”‚ - å¤‰æ›´æ¤œçŸ¥      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Azure DB        â”‚ â† å…¬é–‹ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šä¿å­˜
â”‚ - public_ledgersâ”‚    Ledger DB ã¸ã®è² è·ã‚¼ãƒ­
â”‚ - public_journalsâ”‚
â”‚ - change_logs   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Polimoney       â”‚ â† Hub (Azure DB) ã‹ã‚‰ã®ã¿å–å¾—
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å¤‰æ›´å±¥æ­´ã¨é€æ˜æ€§

### èª²é¡Œ

æ”¿æ²»å®¶ãŒéå»ã®å°å¸³ã‚’ã“ã£ãã‚Šå¤‰æ›´ã—ã¦ã‚‚èª°ã‚‚æ°—ã¥ã‘ãªã„ â†’ ä¸å¥å…¨

### è§£æ±ºç­–: ãƒãƒƒã‚·ãƒ¥ + å°å¸³ãƒ¬ãƒ™ãƒ«ã®å¤‰æ›´ãƒ­ã‚°

1. ä»•è¨³ç™»éŒ²æ™‚ã«**ãƒãƒƒã‚·ãƒ¥**ã‚’ç”Ÿæˆãƒ»ä¿å­˜ï¼ˆæ”¹ã–ã‚“æ¤œçŸ¥ç”¨ï¼‰
2. **å°å¸³ãƒ¬ãƒ™ãƒ«**ã§å¤‰æ›´ãƒ­ã‚°ã‚’ä¿å­˜ï¼ˆä»•è¨³ã”ã¨ã ã¨å¤šã™ãã‚‹ï¼‰
3. Polimoney ã§ã€Œæœ€çµ‚æ›´æ–°æ—¥æ™‚ã€ã¨ã€Œå¤‰æ›´å±¥æ­´ã€ã‚’è¡¨ç¤º

### ã‚¹ã‚­ãƒ¼ãƒ

```sql
-- å…¬é–‹ç”¨å°å¸³ï¼ˆ1å¹´åˆ†ã®åæ”¯å ±å‘Šï¼‰
CREATE TABLE public_ledgers (
    id UUID PRIMARY KEY,
    politician_id UUID NOT NULL REFERENCES politicians(id),
    election_id VARCHAR(50) REFERENCES elections(id),
    fiscal_year INTEGER NOT NULL,
    total_income INTEGER DEFAULT 0,
    total_expense INTEGER DEFAULT 0,
    journal_count INTEGER DEFAULT 0,
    last_updated_at TIMESTAMPTZ NOT NULL,
    first_synced_at TIMESTAMPTZ NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- å…¬é–‹ç”¨ä»•è¨³
CREATE TABLE public_journals (
    id UUID PRIMARY KEY,
    ledger_id UUID NOT NULL REFERENCES public_ledgers(id),
    date DATE NOT NULL,
    description TEXT,
    amount INTEGER NOT NULL,
    contact_name TEXT,
    contact_type VARCHAR(20),
    content_hash VARCHAR(64) NOT NULL,
    synced_at TIMESTAMPTZ NOT NULL
);

-- å°å¸³ãƒ¬ãƒ™ãƒ«ã®å¤‰æ›´ãƒ­ã‚°
CREATE TABLE ledger_change_logs (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    ledger_id UUID REFERENCES public_ledgers(id),
    changed_at TIMESTAMPTZ NOT NULL,
    change_summary TEXT  -- "ä»•è¨³3ä»¶ã‚’è¿½åŠ ", "ä»•è¨³ã‚’ä¿®æ­£" ç­‰
);
```

### Polimoney ã§ã®è¡¨ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å±±ç”°å¤ªéƒ - 2024å¹´åº¦ åæ”¯å ±å‘Šæ›¸                              â”‚
â”‚                                                              â”‚
â”‚ æœ€çµ‚æ›´æ–°: 2024/03/01 10:30  ğŸ“‹ å¤‰æ›´å±¥æ­´                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [åå…¥ãƒ“ãƒ¥ãƒ¼] [æ”¯å‡ºãƒ“ãƒ¥ãƒ¼] [ç§‘ç›®åˆ¥] [æœˆåˆ¥æ¨ç§»]              â”‚
â”‚  ...                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¤‰æ›´å±¥æ­´ãƒ“ãƒ¥ãƒ¼ï¼ˆ2 éšå±¤ï¼‰

**Level 1: å¤‰æ›´ä¸€è¦§**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ å¤‰æ›´å±¥æ­´                                        âœ• é–‰ã˜ã‚‹â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“… 2024/03/01 10:30  ä»•è¨³1ä»¶ã‚’ä¿®æ­£           â–¶ è©³ç´°       â”‚
â”‚  ğŸ“… 2024/02/25 14:15  ä»•è¨³2ä»¶ã‚’è¿½åŠ            â–¶ è©³ç´°       â”‚
â”‚  ğŸ“… 2024/01/20 09:00  åˆå›åŒæœŸï¼ˆ15ä»¶ï¼‰                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Level 2: å¤‰æ›´è©³ç´°ï¼ˆæ—¥ä»˜ã‚¯ãƒªãƒƒã‚¯å¾Œï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ å¤‰æ›´å±¥æ­´ > 2024/03/01 10:30                   â—€ æˆ»ã‚‹    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  âœš è¿½åŠ ã•ã‚ŒãŸä»•è¨³                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  2024/02/20  äº‹å‹™æ‰€è³ƒæ–™      Â¥80,000                        â”‚
â”‚  2024/02/15  äº¤é€šè²»          Â¥5,000                         â”‚
â”‚                                                              â”‚
â”‚  âœ ä¿®æ­£ã•ã‚ŒãŸä»•è¨³                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  2024/01/15  ãƒã‚¹ã‚¿ãƒ¼å°åˆ·                                   â”‚
â”‚    â€¢ é‡‘é¡: Â¥50,000 â†’ Â¥30,000                               â”‚
â”‚    â€¢ æ‘˜è¦: ãƒã‚¹ã‚¿ãƒ¼å°åˆ· â†’ ãƒãƒ©ã‚·å°åˆ·                       â”‚
â”‚                                                              â”‚
â”‚  ğŸ—‘ å‰Šé™¤ã•ã‚ŒãŸä»•è¨³                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ï¼ˆãªã—ï¼‰                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### change_details ã®å½¢å¼

```json
{
  "added": [
    {
      "id": "uuid",
      "date": "2024-02-20",
      "description": "äº‹å‹™æ‰€è³ƒæ–™",
      "amount": 80000
    }
  ],
  "modified": [
    {
      "id": "uuid",
      "date": "2024-01-15",
      "description": "ãƒã‚¹ã‚¿ãƒ¼å°åˆ·",
      "changes": {
        "amount": { "before": 50000, "after": 30000 },
        "description": { "before": "ãƒã‚¹ã‚¿ãƒ¼å°åˆ·", "after": "ãƒãƒ©ã‚·å°åˆ·" }
      }
    }
  ],
  "deleted": [
    {
      "id": "uuid",
      "date": "2024-01-10",
      "description": "å‰Šé™¤ã•ã‚ŒãŸä»•è¨³",
      "amount": 10000
    }
  ]
}
```

### å·®åˆ†ä¿å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

é€æ˜æ€§ã®ãŸã‚ã€é‡è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å·®åˆ†ï¼ˆbefore/afterï¼‰ã‚’ä¿å­˜ï¼š

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰     | ä¿å­˜ | ç†ç”±             |
| -------------- | ---- | ---------------- |
| `amount`       | âœ…   | é‡‘é¡å¤‰æ›´ã¯é‡è¦   |
| `description`  | âœ…   | æ‘˜è¦å¤‰æ›´ã¯é‡è¦   |
| `contact_name` | âœ…   | æ”¯å‡ºå…ˆå¤‰æ›´ã¯é‡è¦ |
| `date`         | âœ…   | æ—¥ä»˜å¤‰æ›´ã¯æ€ªã—ã„ |
| `account_code` | âŒ   | ç§‘ç›®å¤‰æ›´ã¯ç¨€     |

---

## ä»Šå¾Œã®æ‹¡å¼µ

### Phase 1: åŸºç›¤æ§‹ç¯‰ âœ…

- [x] æ”¿æ²»å®¶ / æ”¿æ²»å›£ä½“ / é¸æŒ™ API
- [x] API Key èªè¨¼
- [x] Azure DB æ¥ç¶š

### Phase 2: å…¬é–‹ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–

- [ ] public_ledgers / public_journals ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [ ] ledger_change_logs ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [ ] ãƒãƒƒã‚·ãƒ¥ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…

### Phase 3: Ledger é€£æº

- [ ] Supabase Realtime å—ä¿¡ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- [ ] åŒ¿ååŒ–å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯
- [ ] Ledger â†” Hub API é€£æº

### Phase 4: Polimoney é€£æº

- [ ] å…¬é–‹å°å¸³ API (`/api/v1/public-ledgers`)
- [ ] å¤‰æ›´å±¥æ­´ API (`/api/v1/ledgers/:id/changes`)
- [ ] ç›£æŸ»ãƒ­ã‚°

### Phase 5: æ‹¡å¼µ

- [ ] å¸‚æ°‘å‘ã‘ã‚¢ãƒ—ãƒªå¯¾å¿œ
- [ ] ç ”ç©¶è€…å‘ã‘ API
- [ ] OpenAPI / Swagger ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
