# Polimoney Hub / Ledger ã‚¿ã‚¹ã‚¯çŠ¶æ³

æœ€çµ‚æ›´æ–°: 2024-12-14

---

## ğŸ”§ SQL ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã§å®Ÿè¡ŒãŒå¿…è¦ãªä½œæ¥­

### Hub DB (Supabase)

| ã‚¿ã‚¹ã‚¯                         | çŠ¶æ…‹    | å‚™è€ƒ                                |
| ------------------------------ | ------- | ----------------------------------- |
| `unlock_requests` ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ | âœ… å®Œäº† | ã‚¹ã‚­ãƒ¼ãƒ + RLS                      |
| å¸‚åŒºç”ºæ‘ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ (1,794 ä»¶)  | âœ… å®Œäº† | seed ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å®Ÿè¡Œæ¸ˆ             |
| ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿æŠ•å…¥               | âœ… å®Œäº† | æ”¿æ²»å®¶ 5 åã€å›£ä½“ 6 ä»¶ã€é¸æŒ™ 3 ä»¶ç­‰ |

### Ledger DB (Supabase)

| ã‚¿ã‚¹ã‚¯                              | çŠ¶æ…‹    | SQL      |
| ----------------------------------- | ------- | -------- |
| `ledger_year_closures` ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ | âœ… å®Œäº† | å®Ÿè¡Œæ¸ˆã¿ |
| `sub_accounts` RLS è¿½åŠ              | âœ… å®Œäº† | å®Ÿè¡Œæ¸ˆã¿ |

---

## ğŸ“‹ Hub ã‚¿ã‚¹ã‚¯ä¸€è¦§

### ğŸ”¥ é«˜å„ªå…ˆåº¦

| #   | ã‚¿ã‚¹ã‚¯                        | çŠ¶æ…‹    | è©³ç´°                              |
| --- | ----------------------------- | ------- | --------------------------------- |
| 1   | Azure â†’ Supabase ç§»è¡Œ         | âœ… å®Œäº† | ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ã€ã‚¹ã‚­ãƒ¼ãƒæ›´æ–°æ¸ˆ      |
| 2   | Admin UI èªè¨¼ (Supabase Auth) | âœ… å®Œäº† | Magic Link + Email/Password       |
| 3   | `unlock_requests` API å®Ÿè£…    | âœ… å®Œäº† | Ledger ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä»˜ãƒ»æ‰¿èª |
| 4   | Ledger â†’ Hub åŒæœŸ API         | âœ… å®Œäº† | public_ledgers/journals ã¸ã®åŒæœŸ  |
| 5   | Polimoney JSON å½¢å¼ API       | âœ… å®Œäº† | `/api/v1/polimoney/*` å®Ÿè£…æ¸ˆã¿    |

### ğŸ“‹ ä¸­å„ªå…ˆåº¦

| #   | ã‚¿ã‚¹ã‚¯                       | çŠ¶æ…‹      | è©³ç´°                             |
| --- | ---------------------------- | --------- | -------------------------------- |
| 6   | API ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚° (v1/v2)   | ğŸ”² æœªç€æ‰‹ | `/api/v1/polimoney/...`          |
| 7   | é¸æŒ™åŒºãƒã‚¹ã‚¿åˆæœŸãƒ‡ãƒ¼ã‚¿       | âœ… å®Œäº†   | å…¨ 4,016 åŒºï¼ˆHR/HC/PG/PA/GM/CMï¼‰ |
| 8   | Admin UI: ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ‰¿èªæ©Ÿèƒ½ | âœ… å®Œäº†   | é¸æŒ™ãƒ»å›£ä½“ãƒ»ãƒ­ãƒƒã‚¯è§£é™¤           |
| 9   | Admin UI: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰çµ±è¨ˆ | âœ… å®Œäº†   | åŸºæœ¬çš„ãªçµ±è¨ˆè¡¨ç¤º                 |

### ğŸ“ ä½å„ªå…ˆåº¦

| #   | ã‚¿ã‚¹ã‚¯               | çŠ¶æ…‹      |
| --- | -------------------- | --------- |
| 10  | API ä»•æ§˜æ›¸ (OpenAPI) | âœ… å®Œäº†   |
| 11  | ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ       | ğŸ”² æœªç€æ‰‹ |
| 12  | E2E ãƒ†ã‚¹ãƒˆ           | ğŸ”² æœªç€æ‰‹ |

---

## ğŸ“‹ Ledger ã‚¿ã‚¹ã‚¯ä¸€è¦§

### ğŸ”¥ é«˜å„ªå…ˆåº¦

| #   | ã‚¿ã‚¹ã‚¯                              | çŠ¶æ…‹      | è©³ç´°                          |
| --- | ----------------------------------- | --------- | ----------------------------- |
| 1   | `ledger_year_closures` ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ | âœ… å®Œäº†   | å¹´åº¦ç· ã‚æ©Ÿèƒ½ç”¨                |
| 2   | Hub åŒæœŸæ©Ÿèƒ½ï¼ˆé€ä¿¡å´ï¼‰              | ğŸ”² æœªç€æ‰‹ | æ‰¿èªæ™‚ã®è‡ªå‹•åŒæœŸ + æ‰‹å‹•å†åŒæœŸ |
| 3   | é ˜åè¨¼æ·»ä»˜æ©Ÿèƒ½                      | ğŸ”² æœªç€æ‰‹ | media_assets é€£æº             |

### ğŸ“‹ ä¸­å„ªå…ˆåº¦

| #   | ã‚¿ã‚¹ã‚¯                     | çŠ¶æ…‹      | è©³ç´°                 |
| --- | -------------------------- | --------- | -------------------- |
| 4   | å¹´åº¦ç· ã‚ UI                | ğŸ”² æœªç€æ‰‹ | ç· ã‚/è§£é™¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆ  |
| 5   | ä»•è¨³æ‰¿èªç”»é¢               | ğŸ”² æœªç€æ‰‹ | ApproveJournalScreen |
| 6   | å°å¸³è¨­å®šãƒ»ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†ç”»é¢ | ğŸ”² æœªç€æ‰‹ | LedgerSettingsScreen |
| 7   | è¤‡åˆä»•è¨³å¯¾å¿œ               | ğŸ”² æœªç€æ‰‹ | è¤‡æ•°è¡Œã®æ”¯æ‰•å…ƒ       |

### ğŸ“ ä½å„ªå…ˆåº¦

| #   | ã‚¿ã‚¹ã‚¯                         | çŠ¶æ…‹      |
| --- | ------------------------------ | --------- |
| 8   | å¤–éƒ¨é€£æº (Freee, MoneyForward) | ğŸ”² æœªç€æ‰‹ |
| 9   | AI ç§‘ç›®æ¨å¥¨                    | ğŸ”² æœªç€æ‰‹ |
| 10  | deprecated API ä¿®æ­£            | ğŸ”² æœªç€æ‰‹ |

---

## ğŸ”— é€£æºã‚¿ã‚¹ã‚¯ï¼ˆHub â†” Ledger ä¸¡æ–¹ã«é–¢ä¿‚ï¼‰

| #   | ã‚¿ã‚¹ã‚¯                       | Hub å´             | Ledger å´          | çŠ¶æ…‹          |
| --- | ---------------------------- | ------------------ | ------------------ | ------------- |
| 1   | åŒæœŸ API                     | âœ… å—ä¿¡å®Ÿè£…æ¸ˆ      | ğŸ”² é€ä¿¡ãƒ­ã‚¸ãƒƒã‚¯    | Hub å®Œäº†      |
| 2   | ãƒ­ãƒƒã‚¯è§£é™¤ãƒ•ãƒ­ãƒ¼             | âœ… æ‰¿èª API å®Ÿè£…æ¸ˆ | ğŸ”² ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡  | Hub å®Œäº†      |
| 3   | åŒ¿ååŒ–ãƒ«ãƒ¼ãƒ«                 | -                  | ğŸ”² contacts åŒ¿ååŒ– | Ledger å´ã®ã¿ |
| 4   | account_code â†’ category å¤‰æ› | ğŸ”² å¤‰æ›ãƒ†ãƒ¼ãƒ–ãƒ«    | -                  | Hub å´ã®ã¿    |

---

## ğŸ“… æ¨å¥¨ä½œæ¥­é †åº

### æ¬¡ã®ã‚¹ãƒ—ãƒªãƒ³ãƒˆ

1. **Ledger**: Hub åŒæœŸæ©Ÿèƒ½ï¼ˆé€ä¿¡å´ï¼‰å®Ÿè£…
2. **Hub**: Polimoney JSON å½¢å¼ API
3. **Hub**: é¸æŒ™åŒºãƒã‚¹ã‚¿åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥

### ãã®å¾Œ

1. **Ledger**: å¹´åº¦ç· ã‚ UI
2. **Ledger**: é ˜åè¨¼æ·»ä»˜æ©Ÿèƒ½
3. **ä¸¡æ–¹**: E2E ãƒ†ã‚¹ãƒˆ

---

## ğŸ“Š API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

### å…¬é–‹ APIï¼ˆAPI ã‚­ãƒ¼èªè¨¼ï¼‰

| Method | Endpoint                              | èª¬æ˜                     |
| ------ | ------------------------------------- | ------------------------ |
| GET    | `/api/v1/politicians`                 | æ”¿æ²»å®¶ä¸€è¦§               |
| GET    | `/api/v1/organizations`               | æ”¿æ²»å›£ä½“ä¸€è¦§             |
| GET    | `/api/v1/elections`                   | é¸æŒ™ä¸€è¦§                 |
| POST   | `/api/v1/election-requests`           | é¸æŒ™ç™»éŒ²ãƒªã‚¯ã‚¨ã‚¹ãƒˆ       |
| POST   | `/api/v1/organization-requests`       | å›£ä½“ç™»éŒ²ãƒªã‚¯ã‚¨ã‚¹ãƒˆ       |
| POST   | `/api/v1/sync/journals`               | ä»•è¨³ãƒ‡ãƒ¼ã‚¿åŒæœŸ           |
| POST   | `/api/v1/sync/ledger`                 | å°å¸³ãƒ‡ãƒ¼ã‚¿åŒæœŸ           |
| DELETE | `/api/v1/sync/journals/:id`           | ä»•è¨³å‰Šé™¤                 |
| POST   | `/api/v1/sync/journals/batch-delete`  | ä»•è¨³ä¸€æ‹¬å‰Šé™¤             |
| GET    | `/api/v1/sync/status`                 | åŒæœŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª       |
| POST   | `/api/v1/sync/change-log`             | å¤‰æ›´ãƒ­ã‚°è¨˜éŒ²             |
| POST   | `/api/v1/unlock-requests`             | ãƒ­ãƒƒã‚¯è§£é™¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ |
| GET    | `/api/v1/unlock-requests`             | ãƒ­ãƒƒã‚¯è§£é™¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸€è¦§ |
| GET    | `/api/v1/unlock-requests/check/:id`   | è§£é™¤çŠ¶æ…‹ç¢ºèª             |
| GET    | `/api/v1/master/account-codes`        | å‹˜å®šç§‘ç›®ä¸€è¦§             |
| GET    | `/api/v1/master/account-codes/:code`  | å‹˜å®šç§‘ç›®è©³ç´°             |
| GET    | `/api/v1/master/election-types`       | é¸æŒ™ã‚¿ã‚¤ãƒ—ä¸€è¦§           |
| GET    | `/api/v1/master/public-subsidy-items` | é¸æŒ™å…¬å–¶è²»ç›®ä¸€è¦§         |
| GET    | `/api/v1/master/municipalities`       | å¸‚åŒºç”ºæ‘ä¸€è¦§             |
| GET    | `/api/v1/master/prefectures`          | éƒ½é“åºœçœŒä¸€è¦§             |
| GET    | `/api/v1/master/metadata`             | ãƒã‚¹ã‚¿æ›´æ–°æ—¥æ™‚           |

### Polimoney APIï¼ˆAPI ã‚­ãƒ¼èªè¨¼ï¼‰

| Method | Endpoint                                     | èª¬æ˜                     |
| ------ | -------------------------------------------- | ------------------------ |
| GET    | `/api/v1/polimoney/elections`                | å…¬é–‹é¸æŒ™ä¸€è¦§             |
| GET    | `/api/v1/polimoney/elections/:id/journals`   | é¸æŒ™åæ”¯ãƒ‡ãƒ¼ã‚¿å–å¾—       |
| GET    | `/api/v1/polimoney/elections/:id/candidates` | é¸æŒ™ã®å€™è£œè€…ä¸€è¦§         |
| GET    | `/api/v1/polimoney/ledgers/:id/journals`     | å°å¸³ ID æŒ‡å®šã§ãƒ‡ãƒ¼ã‚¿å–å¾— |

### ç®¡ç†è€… APIï¼ˆBearer ãƒˆãƒ¼ã‚¯ãƒ³èªè¨¼ï¼‰

| Method | Endpoint                                       | èª¬æ˜                     |
| ------ | ---------------------------------------------- | ------------------------ |
| GET    | `/api/admin/election-requests`                 | é¸æŒ™ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸€è¦§       |
| PUT    | `/api/admin/election-requests/:id/approve`     | é¸æŒ™ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ‰¿èª       |
| PUT    | `/api/admin/election-requests/:id/reject`      | é¸æŒ™ãƒªã‚¯ã‚¨ã‚¹ãƒˆå´ä¸‹       |
| GET    | `/api/admin/organization-requests`             | å›£ä½“ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸€è¦§       |
| PUT    | `/api/admin/organization-requests/:id/approve` | å›£ä½“ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ‰¿èª       |
| PUT    | `/api/admin/organization-requests/:id/reject`  | å›£ä½“ãƒªã‚¯ã‚¨ã‚¹ãƒˆå´ä¸‹       |
| GET    | `/api/admin/unlock-requests`                   | ãƒ­ãƒƒã‚¯è§£é™¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸€è¦§ |
| PUT    | `/api/admin/unlock-requests/:id/approve`       | ãƒ­ãƒƒã‚¯è§£é™¤æ‰¿èª           |
| PUT    | `/api/admin/unlock-requests/:id/reject`        | ãƒ­ãƒƒã‚¯è§£é™¤å´ä¸‹           |
| GET    | `/api/admin/users`                             | ç®¡ç†è€…ä¸€è¦§               |
| POST   | `/api/admin/users`                             | ç®¡ç†è€…æ‹›å¾…               |
| PUT    | `/api/admin/users/:id`                         | ç®¡ç†è€…æƒ…å ±æ›´æ–°           |
| DELETE | `/api/admin/users/:id`                         | ç®¡ç†è€…å‰Šé™¤ï¼ˆè«–ç†ï¼‰       |

---

## æ›´æ–°å±¥æ­´

- 2024-12-14: OpenAPI ä»•æ§˜æ›¸å®Œæˆï¼ˆSync/Unlock/Admin API è¿½åŠ ï¼‰
- 2024-12-14: Polimoney JSON å½¢å¼ API å®Ÿè£…ã€é¸æŒ™åŒºãƒã‚¹ã‚¿ 4,016 åŒºç™»éŒ²
- 2024-12-14: å‹˜å®šç§‘ç›®ãƒã‚¹ã‚¿ã€é¸æŒ™å…¬å–¶è²»ç›®ãƒã‚¹ã‚¿è¿½åŠ 
- 2024-12-14: åŒæœŸ APIã€ãƒ­ãƒƒã‚¯è§£é™¤ API å®Ÿè£…å®Œäº†
- 2024-12-14: åˆç‰ˆä½œæˆï¼ˆAzure ç§»è¡Œå®Œäº†å¾Œã®çŠ¶æ…‹ã‚’åæ˜ ï¼‰
